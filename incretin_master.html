<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Incretin Master Monthly Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;800&display=swap');
        :root {
            --primary: #2563eb; --success: #10b981; --danger: #ef4444; --gray: #64748b; --dark: #0f172a;
        }
        body { font-family: 'Pretendard', sans-serif; background: #f8fafc; color: var(--dark); margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .container { max-width: 700px; width: 100%; }

        /* AI Doctor Prescription Card */
        .ai-card { background: white; border-radius: 24px; padding: 25px; margin-bottom: 25px; border: 2px solid var(--primary); box-shadow: 0 10px 25px rgba(37, 99, 235, 0.1); }
        .ai-title { font-weight: 800; color: var(--primary); margin-bottom: 12px; display: flex; align-items: center; gap: 8px; font-size: 1.2rem; }
        .ai-content { background: #f8fafc; padding: 15px; border-radius: 12px; font-size: 0.95rem; line-height: 1.6; border-left: 4px solid var(--primary); }

        /* Monthly Simulation Dashboard */
        .sim-card { background: white; border-radius: 24px; padding: 30px; margin-bottom: 25px; border: 2px solid var(--success); }
        .sim-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px; text-align: center; }
        .sim-item { background: #f0fdf4; padding: 15px; border-radius: 15px; }
        .sim-val { font-size: 1.3rem; font-weight: 800; color: var(--success); display: block; }
        .sim-lbl { font-size: 0.75rem; color: var(--gray); }

        /* Input & Stats */
        .glass-card { background: white; border-radius: 24px; padding: 25px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); margin-bottom: 25px; }
        .profile-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px; }
        .input-group label { font-size: 0.75rem; font-weight: 700; color: var(--gray); display: block; margin-bottom: 5px; }
        input { width: 100%; padding: 12px; border-radius: 12px; border: 1px solid #e2e8f0; font-family: inherit; font-weight: 600; box-sizing: border-box; }

        /* Routine List */
        .item { background: white; border-radius: 20px; padding: 20px; margin-bottom: 15px; display: flex; gap: 15px; border-left: 6px solid #cbd5e1; cursor: pointer; transition: 0.3s; position: relative; }
        .item.checked { background: #f0fdf4; border-left-color: var(--success); }
        .item.critical { border-left-color: var(--danger); }
        .item.no-pts { border-left-color: var(--gray); opacity: 0.7; cursor: default; }

        /* Modal */
        #weekly-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1000; justify-content: center; align-items: center; }
        .modal-content { background: white; width: 90%; max-width: 500px; padding: 30px; border-radius: 24px; max-height: 80vh; overflow-y: auto; }

        /* How to use 100% */
        .guide-box { background: white; border-radius: 24px; padding: 25px; border: 1px solid var(--gray); margin-top: 30px; }
        .guide-h { font-size: 1.1rem; font-weight: 800; color: var(--primary); margin-bottom: 15px; border-bottom: 2px solid var(--primary); padding-bottom: 5px; }
        .guide-sec { margin-bottom: 15px; font-size: 0.9rem; line-height: 1.6; }

        @media print { .no-print { display: none !important; } }
    </style>
</head>
<body>

<div class="container">
    <header style="text-align: center; margin-bottom: 25px;">
        <h1 style="color: var(--primary); margin: 0;">ì¸í¬ë ˆí‹´ ë§ˆìŠ¤í„°: ì›”ê°„ ì‹œë®¬ë ˆì´í„°</h1>
        <p style="color: var(--gray); font-size: 0.9rem; margin-top: 5px;">IMEM-Plus ì•Œê³ ë¦¬ì¦˜ ê¸°ë°˜ í˜¸ë¥´ëª¬ íš¨ìœ¨ ë¶„ì„</p>
    </header>

    <div class="ai-card">
        <div class="ai-title">ğŸ©º ì¸í¬ë ˆí‹´ AI ë§ì¶¤ ì²˜ë°©</div>
        <div class="ai-content" id="ai-rx">ë°ì´í„°ë¥¼ ì…ë ¥í•˜ë©´ AI ì£¼ì¹˜ì˜ì˜ ë¶„ì„ì´ ì‹œì‘ë©ë‹ˆë‹¤.</div>
    </div>

    <div class="sim-card" id="sim-view" style="display:none;">
        <h2 style="margin: 0 0 20px 0; color: var(--success); font-size: 1.2rem;">ğŸ“‰ ì›”ê°„ ì²´ì¤‘ ê°ëŸ‰ ì‹œë®¬ë ˆì´ì…˜ (4ì£¼ ì˜ˆì¸¡)</h2>
        <div class="sim-grid">
            <div class="sim-item"><span class="sim-lbl">ì˜ˆìƒ ê°ëŸ‰</span><span class="sim-val" id="sim-kg">- kg</span></div>
            <div class="sim-item"><span class="sim-lbl">ì§€ë°© ëŒ€ì‚¬ìœ¨</span><span class="sim-val" id="sim-fat">- %</span></div>
            <div class="sim-item"><span class="sim-lbl">ê·¼ìœ¡ ë³´ì¡´ìœ¨</span><span class="sim-val" id="sim-muscle">- %</span></div>
        </div>
        <canvas id="simChart" height="150"></canvas>
    </div>

    <div class="glass-card">
        <div class="profile-grid no-print">
            <div class="input-group"><label>ì´ë¦„</label><input type="text" id="p-name" value="ì‚¬ìš©ì"></div>
            <div class="input-group"><label>ì±Œë¦°ì§€ ì‹œì‘ì¼</label><input type="date" id="p-start"></div>
            <div class="input-group"><label>í‚¤ (cm)</label><input type="number" id="p-h" value="170"></div>
            <div class="input-group"><label>ì‹œì‘ ì²´ì¤‘ (kg)</label><input type="number" id="p-sw" value="80"></div>
            <div class="input-group"><label>í˜„ì¬ ì²´ì¤‘ (kg)</label><input type="number" id="p-cw" value="78"></div>
            <div class="input-group"><label>ëª©í‘œ ì²´ì¤‘ (kg)</label><input type="number" id="p-gw" value="70"></div>
        </div>
        <div style="display:flex; justify-content:space-between; text-align:center;">
            <div><span style="font-size:0.7rem; color:var(--gray)">í˜„ì¬ BMI</span><br><b id="bmi-v" style="font-size:1.3rem; color:var(--primary)">0.0</b></div>
            <div><span style="font-size:0.7rem; color:var(--gray)">ì£¼ê°„ í‰ê·  ì ìˆ˜</span><br><b id="avg-v" style="font-size:1.3rem; color:var(--primary)">0</b></div>
            <div><span style="font-size:0.7rem; color:var(--gray)">ë‹¬ì„±ë¥ </span><br><b id="ach-v" style="font-size:1.3rem; color:var(--danger)">0%</b></div>
        </div>
    </div>

    <div style="display:flex; gap:10px; margin-bottom:20px;" class="no-print">
        <button class="btn" style="flex:1; padding:14px; border-radius:12px; border:none; background:var(--primary); color:white; font-weight:800; cursor:pointer;" onclick="runDeepSimulation()">ì›”ê°„ ì •ë°€ ë¶„ì„ ì‹¤í–‰</button>
        <button class="btn" style="flex:1; padding:14px; border-radius:12px; border:none; background:var(--dark); color:white; font-weight:800; cursor:pointer;" onclick="window.print()">PDF ë¦¬í¬íŠ¸ ì €ì¥</button>
    </div>

    <input type="date" id="target-date" class="no-print" style="margin-bottom:20px; width:100%;">

    <div id="routine-list"></div>

    <div class="guide-box">
        <div class="guide-h">ğŸ’¡ [ì´ ì•±ì„ 100% í™œìš©í•˜ëŠ” ë²•]</div>
        <div class="guide-sec">
            <strong>1. ê°€ì¥ ì–´ë ¤ìš´ êµ¬ê°„ì€ 17:30ì…ë‹ˆë‹¤:</strong><br>
            ëŠ¦ì€ ì‹ì‚¬ëŠ” í˜ˆë‹¹ì„ 18% ë†’ì´ê³  ì§€ë°© ì—°ì†Œë¥¼ 10% ë°©í•´í•©ë‹ˆë‹¤. í‡´ê·¼ 30ë¶„ ì „ ì•ŒëŒì„ ë§ì¶”ê³  ìë¦¬ì—ì„œ ê°„ë‹¨íˆ ë¨¹ì„ ìˆ˜ ìˆëŠ” ë‹¨ë°±ì§ˆ ì‰ì´í¬ë¥¼ ì¤€ë¹„í•˜ëŠ” ê²ƒì´ ì„±ê³µì˜ ì—´ì‡ ì…ë‹ˆë‹¤[cite: 32, 33].
        </div>
        <div class="guide-sec">
            <strong>2. 11:00 í”„ë¦¬ë¡œë“œ(Preload)ëŠ” ì•½ê³¼ ê°™ìŠµë‹ˆë‹¤:</strong><br>
            ì ì‹¬ 30ë¶„ ì „(11:00) ë‹¨ë°±ì§ˆ ì„­ì·¨ëŠ” GLP-1 í˜¸ë¥´ëª¬ì„ ë¯¸ë¦¬ ê¹¨ì›Œ ì ì‹¬ í­ì‹ì„ ë§‰ê³  ì‹ê³¤ì¦ì„ ì˜ˆë°©í•˜ëŠ” 'í˜¸ë¥´ëª¬ ë°©íŒŒì œ'ì…ë‹ˆë‹¤[cite: 36, 37].
        </div>
        <div class="guide-sec">
            <strong>3. ì ì‹¬ ì§í›„ ì‚°ì±…(11:50~12:30)ì€ íƒ€í˜‘í•˜ì§€ ë§ˆì„¸ìš”:</strong><br>
            ì‹ì‚¬ í›„ 40ë¶„ ê±·ê¸°ëŠ” í—¬ìŠ¤ì¥ 1ì‹œê°„ ìš´ë™ë³´ë‹¤ í˜ˆë‹¹ ê´€ë¦¬ì— íš¨ê³¼ì ì…ë‹ˆë‹¤[cite: 40]. ì¸ìŠë¦° ì—†ì´ ë‹¹ë¶„ì„ ì†Œëª¨í•˜ëŠ” ë§ˆë²•ì˜ ê³¨ë“ íƒ€ì„ì„ ë†“ì¹˜ì§€ ë§ˆì„¸ìš”[cite: 39].
        </div>
    </div>
</div>

<div id="weekly-modal">
    <div class="modal-content">
        <h2 id="modal-h" style="color:var(--primary); margin-top:0;">ğŸ“Š ì£¼ê°„ AI ì„±ê³¼ ë¶„ì„</h2>
        <div id="modal-body" style="line-height:1.6; font-size:0.9rem;"></div>
        <button style="width:100%; margin-top:20px; padding:12px; border-radius:12px; border:none; background:var(--primary); color:white; font-weight:700; cursor:pointer;" onclick="closeModal()">ë¦¬í¬íŠ¸ í™•ì¸ ì™„ë£Œ</button>
    </div>
</div>

<script>
    const routine = [
        { t: "07:00", title: "ê¸°ìƒ ë¦¬ì…‹ + ìœ ì‚°ê· ", pts: 5, action: "ë¬¼ 1ì” + í–‡ë¹› ë³´ê¸°", nudge: "ì•„ì¹¨ í–‡ì‚´ì€ ì§€ë°© ì—°ì†Œ ìŠ¤ìœ„ì¹˜ë¥¼ ì¼­ë‹ˆë‹¤." },
        { t: "08:00", title: "ì¶œê·¼ í™œë™ (NEAT)", pts: 0, noScore: true, action: "ê³„ë‹¨ ì´ìš©, ëŒ€ì¤‘êµí†µ ì„œì„œ ê°€ê¸°", nudge: "ì¶œê·¼ê¸¸ì˜ ê°€ë²¼ìš´ ì›€ì§ì„ì´ ë±ƒì‚´ì„ íƒœì›ë‹ˆë‹¤." },
        { t: "09:30", title: "ì»¤í”¼ ë¶€ìŠ¤íŠ¸", pts: 5, action: "ë¸”ë™ì»¤í”¼ 1ì”", nudge: "ì»¤í”¼ì˜ í´ë¦¬í˜ë†€ì´ GLP-1 ë¶„ë¹„ë¥¼ ì˜ˆì—´í•©ë‹ˆë‹¤." },
        { t: "11:00", title: "ì¸í¬ë ˆí‹´ í”„ë¦¬ë¡œë“œ", pts: 10, crit: true, action: "ë‹¬ê±€ 1ê°œ or ë‘ìœ ", nudge: "ì ì‹¬ í­ì‹ì„ ë§‰ëŠ” ê°•ë ¥í•œ í˜¸ë¥´ëª¬ ë°©íŒŒì œì…ë‹ˆë‹¤." },
        { t: "11:30", title: "ìˆœì„œ ì‹ì‚¬ë²•", pts: 15, crit: true, action: "ì±„ì†Œ â†’ ë‹¨ë°±ì§ˆ â†’ íƒ„ìˆ˜í™”ë¬¼", nudge: "ìˆœì„œë§Œ ë°”ê¿”ë„ ì¸ìŠë¦° ìŠ¤íŒŒì´í¬ê°€ ë°©ì§€ë©ë‹ˆë‹¤." },
        { t: "11:50", title: "ê³¨ë“ íƒ€ì„ ì‚°ì±…", pts: 15, crit: true, action: "12:30ê¹Œì§€ ê±·ê¸°", nudge: "ì§€ê¸ˆ ê±·ëŠ” ê±¸ìŒì€ ë‹¹ë¶„ì„ ì¦‰ì‹œ ì†Œëª¨í•©ë‹ˆë‹¤." },
        { t: "14:30", title: "ìŠ¤íƒ ë”© ë¸Œë ˆì´í¬", pts: 5, action: "3ë¶„ê°„ ì„œ ìˆê¸° or ìŠ¤ì¿¼íŠ¸", nudge: "ì ê¹ì˜ ì¼ì–´ì„¬ì´ ì·Œì¥ì˜ í”¼ë¡œë¥¼ ëœì–´ì¤ë‹ˆë‹¤." },
        { t: "17:30", title: "ì €ë… ì¡°ê¸° ë§ˆê°", pts: 20, crit: true, action: "18:00 ì „ ì‹ì‚¬ ì™„ë£Œ", nudge: "í‡´ê·¼ í›„ ì‹ì‚¬ëŠ” ëŠ¦ìŠµë‹ˆë‹¤. íšŒì‚¬ì—ì„œ ë¯¸ë¦¬ ë“œì„¸ìš”!" },
        { t: "20:00", title: "ê·¼ìœ¡ ë°©ì–´ ìš´ë™", pts: 15, muscle: true, action: "ê·¼ë ¥ ìš´ë™ 30ë¶„", nudge: "í—ˆë²…ì§€ ê·¼ìœ¡ì€ í‰ìƒì˜ í˜ˆë‹¹ ì¡°ì ˆ ì¥ì¹˜ì…ë‹ˆë‹¤." },
        { t: "23:00", title: "ìˆ˜ë©´ í™•ë³´", pts: 10, action: "7ì‹œê°„ ìˆ™ë©´", nudge: "í‘¹ ìì•¼ ë‚´ì¼ ì‹ìš• ì¡°ì ˆì´ ì‰¬ì›Œì§‘ë‹ˆë‹¤." }
    ];

    let simChart;
    const dateInput = document.getElementById('target-date');
    dateInput.value = new Date().toISOString().split('T')[0];

    function init() {
        renderList();
        loadAll();
        checkMonday();
    }

    function renderList() {
        const list = document.getElementById('routine-list');
        list.innerHTML = routine.map((item, i) => `
            <div class="item ${item.crit ? 'critical' : ''} ${item.noScore ? 'no-pts' : ''}" onclick="toggleTask(${i})">
                <input type="checkbox" id="task-${i}" ${item.noScore ? 'checked disabled' : ''} style="width:20px; height:20px;">
                <div style="flex:1">
                    <span style="font-size:0.75rem; font-weight:800; color:var(--primary);">${item.t} | í•µì‹¬í–‰ë™</span>
                    <span class="title" style="display:block; font-weight:800; font-size:1.1rem; margin:3px 0;">${item.title}</span>
                    <div style="font-size:0.8rem; color:var(--gray); margin-bottom:5px;"><b>í–‰ë™:</b> ${item.action}</div>
                    <div style="font-size:0.75rem; color:var(--primary); font-style:italic;">"${item.nudge}"</div>
                    ${item.pts > 0 ? `<span style="position:absolute; right:20px; top:20px; font-weight:800; color:var(--success);">+${item.pts}</span>` : ''}
                </div>
            </div>
        `).join('');
    }

    function checkMonday() {
        if(new Date().getDay() === 1) {
            const hist = JSON.parse(localStorage.getItem('inc_monthly_hist') || '{}');
            const dates = Object.keys(hist).sort();
            if(dates.length >= 1) {
                const name = document.getElementById('p-name').value;
                document.getElementById('modal-body').innerHTML = `<b>${name} ë‹˜, í•œ ì£¼ê°„ ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤!</b> ì§€ë‚œì£¼ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ì—¬ ì´ë²ˆ ì£¼ ì„±ê³µ ì „ëµì„ ì„¸ì›Œë‘ì—ˆìŠµë‹ˆë‹¤. 'ì •ë°€ ë¶„ì„ ì‹¤í–‰' ë²„íŠ¼ì„ ëˆŒëŸ¬ë³´ì„¸ìš”.`;
                document.getElementById('weekly-modal').style.display = 'flex';
            }
        }
    }

    function toggleTask(i) {
        if(routine[i].noScore) return;
        const cb = document.getElementById(`task-${i}`);
        cb.checked = !cb.checked;
        saveDaily();
    }

    function saveDaily() {
        let score = 0; let checks = [];
        routine.forEach((item, i) => { if(document.getElementById(`task-${i}`).checked) score += item.pts; checks.push(document.getElementById(`task-${i}`).checked); });
        const hist = JSON.parse(localStorage.getItem('inc_monthly_hist') || '{}');
        hist[dateInput.value] = { score, checks, w: document.getElementById('p-cw').value };
        localStorage.setItem('inc_monthly_hist', JSON.stringify(hist));
        saveProfile();
        refreshStats();
    }

    function saveProfile() {
        const p = { name: document.getElementById('p-name').value, start: document.getElementById('p-start').value, h: document.getElementById('p-h').value, sw: document.getElementById('p-sw').value, gw: document.getElementById('p-gw').value };
        localStorage.setItem('inc_monthly_profile', JSON.stringify(p));
    }

    function loadAll() {
        const p = JSON.parse(localStorage.getItem('inc_monthly_profile') || '{}');
        if(p.name) {
            document.getElementById('p-name').value = p.name;
            document.getElementById('p-start').value = p.start;
            document.getElementById('p-h').value = p.h;
            document.getElementById('p-sw').value = p.sw;
            document.getElementById('p-gw').value = p.gw;
        }
        const hist = JSON.parse(localStorage.getItem('inc_monthly_hist') || '{}');
        const data = hist[dateInput.value];
        routine.forEach((item, i) => { if(!item.noScore) document.getElementById(`task-${i}`).checked = data ? data.checks[i] : false; });
        if(data && data.w) document.getElementById('p-cw').value = data.w;
        refreshStats();
    }

    function refreshStats() {
        const h = parseFloat(document.getElementById('p-h').value) / 100;
        const cw = parseFloat(document.getElementById('p-cw').value);
        const sw = parseFloat(document.getElementById('p-sw').value);
        const gw = parseFloat(document.getElementById('p-gw').value);

        if(h > 0 && cw > 0) document.getElementById('bmi-v').innerText = (cw / (h * h)).toFixed(1);
        if(sw && gw && cw) {
            const pct = Math.max(0, Math.min(100, ((sw - cw) / (sw - gw)) * 100));
            document.getElementById('ach-v').innerText = pct.toFixed(1) + '%';
        }

        const hist = JSON.parse(localStorage.getItem('inc_monthly_hist') || '{}');
        const scores = Object.values(hist).map(d => d.score);
        const avg = scores.length ? Math.round(scores.reduce((a,b)=>a+b)/scores.length) : 0;
        document.getElementById('avg-v').innerText = avg;
        document.getElementById('days-v').innerText = scores.length;

        updateRX(scores.length ? scores[scores.length-1] : 0, avg);
    }

    function updateRX(todayScore, avg) {
        const rx = document.getElementById('ai-rx');
        const name = document.getElementById('p-name').value;
        if(todayScore >= 85) rx.innerHTML = `<b>[Master êµ¬ê°„]</b> ${name}ë‹˜, ì¸ìŠë¦° ìˆ˜ì¹˜ê°€ ë‚®ê²Œ ìœ ì§€ë˜ì–´ ì§€ë°© ì—°ì†Œ ëª¨ë“œê°€ í™œë°œí•©ë‹ˆë‹¤[cite: 52]. ê·¼ë ¥ ìš´ë™ì„ í†µí•´ ëŒ€ì‚¬ ê¸°ì´ˆë¥¼ ë‹¤ì§€ì„¸ìš”!`;
        else if(todayScore >= 50) rx.innerHTML = `<b>[Achiever êµ¬ê°„]</b> ì•ˆì •ì  ê°ëŸ‰ ê¶¤ë„ì…ë‹ˆë‹¤. íŠ¹íˆ <b>'ì €ë… ì‹ì‚¬ ì¡°ê¸° ë§ˆê°'</b> ì—¬ë¶€ê°€ ë‚´ì¼ì˜ ê°ëŸ‰ ì†ë„ë¥¼ ê²°ì •í•©ë‹ˆë‹¤[cite: 82].`;
        else rx.innerHTML = `<b>[Reset êµ¬ê°„]</b> ëŒ€ì‚¬ ìŠ¤ìœ„ì¹˜ë¥¼ ì¼¤ ë•Œì…ë‹ˆë‹¤. 'í”„ë¦¬ë¡œë“œ'ì™€ 'ì•„ì¹¨ ë¬¼ í•œ ì”'ì´ë¼ëŠ” ì‰¬ìš´ ì„±ê³µë¶€í„° ì˜¤ëŠ˜ ë°”ë¡œ ì‹œì‘í•´ë³´ì„¸ìš”[cite: 146, 147].`;
    }

    // IMEM-Plus ê³ ë„í™” ì‹œë®¬ë ˆì´ì…˜ 
    function runDeepSimulation() {
        const cw = parseFloat(document.getElementById('p-cw').value);
        const sw = parseFloat(document.getElementById('p-sw').value);
        const gw = parseFloat(document.getElementById('p-gw').value);
        const avg = parseInt(document.getElementById('avg-v').innerText) || 85;

        if(!cw || !gw) return alert("í˜„ì¬ ì²´ì¤‘ê³¼ ëª©í‘œ ì²´ì¤‘ì„ ì…ë ¥í•˜ì„¸ìš”.");
        document.getElementById('sim-view').style.display = 'block';

        // IMEM ë³€ìˆ˜ ê³„ì‚° [cite: 91, 114-116]
        let beta = avg >= 85 ? 1.3 : (avg >= 50 ? 1.0 : 0.5); // ìˆœì‘ë„ ê³„ìˆ˜
        let alpha = 1.15; // ì¸í¬ë ˆí‹´ íš¨ìœ¨ ê³„ìˆ˜ (íƒ€ì´ë°+ì‹œí€€ì‹± í‰ê·  ì ìš©) [cite: 121]
        
        // ê·¼ìœ¡ ë°©ì–´ ë³´ì • (ìµœê·¼ 7ì¼ ì¤‘ ê·¼ë ¥ìš´ë™ ì°¸ì—¬ë„) 
        const hist = JSON.parse(localStorage.getItem('inc_monthly_hist') || '{}');
        const last7Checks = Object.values(hist).slice(-7).map(d => d.checks[8]);
        const muscleDefenseRate = (last7Checks.filter(c => c).length / 7) || 0;

        let labels = ["í˜„ì¬"];
        let weights = [cw];
        let tempW = cw;

        for(let w = 1; w <= 4; w++) {
            let loss = 0;
            if(w === 1) loss = 1.5 * alpha * beta; // ìˆ˜ë¶„ ë°°ì¶œ [cite: 70]
            else if(w === 2) loss = 0.8 * alpha * beta; // ì§€ë°© ì—°ì†Œ ì§„ì… [cite: 73]
            else loss = 0.6 * alpha * beta; // ì²´í˜• ë³€í™” [cite: 76]
            
            tempW -= loss;
            labels.push(w + "ì£¼");
            weights.push(tempW.toFixed(1));
        }

        const totalLoss = cw - tempW;
        document.getElementById('sim-kg').innerText = `-${totalLoss.toFixed(1)} kg`;
        document.getElementById('sim-fat').innerText = `${(avg >= 85 ? 90 : 70)} %`;
        document.getElementById('sim-muscle').innerText = `${(70 + (muscleDefenseRate * 25)).toFixed(0)} %`;

        const ctx = document.getElementById('simChart').getContext('2d');
        if(simChart) simChart.destroy();
        simChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'ì˜ˆìƒ ì²´ì¤‘ ì¶”ì´',
                    data: weights,
                    borderColor: '#10b981', backgroundColor: 'rgba(16, 185, 129, 0.1)', fill: true, tension: 0.4
                }, {
                    label: 'ëª©í‘œ ì²´ì¤‘',
                    data: new Array(labels.length).fill(gw),
                    borderColor: '#ef4444', borderDash: [5, 5], pointRadius: 0
                }]
            },
            options: { plugins: { title: { display: true, text: 'IMEM-Plus ê¸°ë°˜ 4ì£¼ ì •ë°€ ì˜ˆì¸¡' } } }
        });
    }

    function closeModal() { document.getElementById('weekly-modal').style.display = 'none'; }
    dateInput.addEventListener('change', loadAll);
    document.querySelectorAll('input').forEach(i => i.addEventListener('input', saveDaily));
    window.onload = init;
</script>
</body>
</html>
